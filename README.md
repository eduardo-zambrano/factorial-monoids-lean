# Lean 4 Formalization: Factorial Monoids via Labeled Factorization Counts

A Lean 4 formalization of the paper "Characterizing Factorial Monoids via Labeled Factorization Counts" by Eduardo Zambrano.

## Overview

This project proves that ordinary multiplication on natural numbers can be characterized purely through counting labeled factorizations. The main result (Theorem 9.1) shows that under three axiomatic properties (PP-D, CFI, and CPL), a reduced atomic commutative monoid M satisfies:
- **(a)** M is factorial (isomorphic to the free commutative monoid on its atoms)
- **(b)** The atom set is countably infinite, hence M is isomorphic to (N, x)

## The Three Axioms

| Axiom | Name | Statement |
|-------|------|-----------|
| **PP-D** | Powers Distinct | For each atom p, the map e -> p^e is injective |
| **CFI** | Coprime parts Factor Independently | For coprime x, y: the coordinatewise map F_2(x) x F_2(y) -> F_2(x*y) is a bijection |
| **CPL** | Coprime tuples in every Length | For every r, there exist r pairwise coprime non-units |

A key derived property is **PP-P** (Prime Powers factorially closed): if x*y is in the submonoid generated by atom p, then so are x and y.

## Proof Structure

The proof proceeds through the following chain of implications:

```
                    CFI
                     |
                     v
         +---> Proposition 5.3: CFI ==> PP-P
         |
         |       PP-D + PP-P
         |           |
         |           v
         |    Theorem 6.2: Local stars-and-bars
         |    F_k(p^e) = C(e+k-1, k-1)
         |
   CFI --+
         |
         |       CFI
         |        |
         |        v
         +---> Proposition 7.2: Coprime multiplicativity
               F_k(x*y) = F_k(x) * F_k(y) for coprime x, y
                     |
                     v
              Theorem 8.2: Master formula
              F_k(m) = prod_p C(v_p(m)+k-1, k-1)
                     |
                     v
              Proposition 8.3: Additivity of valuations
              v_p(x*y) = v_p(x) + v_p(y)
                     |
                     v
              Corollary 8.4: Factorial structure   <-- MAIN ALGEBRAIC RESULT
              M is isomorphic to the free commutative monoid on P
                     |
                     + CPL
                     |
                     v
              Theorem 9.1: Main result
              M is factorial AND |P| = countably infinite
              Hence M is isomorphic to (N, x)
```

## File Structure and Paper Correspondence

| File | Paper Section | Key Results |
|------|---------------|-------------|
| `Basic.lean` | Sections 2-3 | Definition 2.1 (monoid terminology), Definition 2.2 (F_k), Axioms PP-D/CFI/CPL, Property PP-P |
| `Utilities.lean` | - | Transfer lemmas, `Disjoint_Support_implies_Coprime` |
| `LocalPurity.lean` | Section 5 | Lemma 5.1, Lemma 5.2, **Proposition 5.3** (CFI ==> PP-P) |
| `LocalCharacterization.lean` | Section 6 | **Lemma 6.1** (unique factorization in prime powers), **Theorem 6.2** (local stars-and-bars) |
| `GlobalMultiplicativity.lean` | Section 7 | Lemma 7.1 (CFI extends to k factors), **Proposition 7.2** (coprime multiplicativity) |
| `AtomsArePrime_v2_aristotle.lean` | - | `atoms_are_prime`: CFI implies atoms are prime |
| `MasterFormula_v2_aristotle.lean` | Section 8 | **Corollary 7.3**, **Proposition 8.3**, **Corollary 8.4** (factorial structure) |
| `MainTheorem.lean` | Section 9 | **Theorem 9.1** (main result) |

## Formalization Status

### Fully Proven Results

| Paper Reference | Lean Name | Description |
|-----------------|-----------|-------------|
| Corollary 8.4 | `cor_factorial` | PP-D + CFI implies M is factorial |
| Proposition 8.3 | `prop_val_additive` | Additivity of p-adic valuations |
| Corollary 7.3 | `cor_squarefree` | Squarefree diagnostic: F_2(m) = 2^omega(m) |
| Proposition 7.2 | `prop_coprime_mult` | Coprime multiplicativity of F_k |
| Theorem 6.2 | `Theorem_Local_SB` | Local stars-and-bars formula |
| Lemma 6.1 | `Lemma_PP_Unique` | Unique factorization within prime powers |
| - | `atoms_are_prime` | CFI implies atoms are prime |

### In Progress

| Paper Reference | Lean Name | Description | Status |
|-----------------|-----------|-------------|--------|
| Theorem 9.1 | `thm_main` | Main result (factorial + atoms infinite) | Sorries |
| Theorem 9.1(b) | `atoms_infinite_of_CPL` | CPL implies atoms are infinite | Sorries |
| Proposition 5.3 | `Prop_CFI_implies_PPP` | CFI implies PP-P | Sorries |
| Lemma 8.1 | `lem_primewise_impl` | Primewise decomposition | Sorries |

### Summary

| Section | Status |
|---------|--------|
| Definitions (Sections 2-3) | Complete |
| Local Purity (Section 5) | Partial - Proposition 5.3 has sorries |
| Local Characterization (Section 6) | **Complete** |
| Global Multiplicativity (Section 7) | **Complete** |
| Master Formula (Section 8) | **Complete** (Corollary 8.4 proven) |
| Main Theorem (Section 9) | In progress |

Note: The main algebraic result (**Corollary 8.4**: factorial structure) is fully proven. Some upstream lemmas (like Proposition 5.3) still have sorries, but the key results were proven via alternative paths.

## Building

Requires Lean 4 v4.24.0 and Mathlib.

```bash
# Get Mathlib cache (required before first build)
lake exe cache get

# Build the project
lake build
```

## Dependencies

- Lean 4 v4.24.0
- Mathlib (specific commit in lakefile.lean)

## Author

Eduardo Zambrano

## License

Apache 2.0

## Acknowledgments

Some proofs were completed with assistance from [Aristotle](https://harmonic.fun/) (Harmonic's AI theorem prover).
