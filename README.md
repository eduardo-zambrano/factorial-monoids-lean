# Lean 4 Formalization: Factorial Monoids via Labeled Factorization Counts

A Lean 4 formalization of the paper "Characterizing Factorial Monoids via Labeled Factorization Counts" by Eduardo Zambrano.

## Overview

This project proves that under axioms PP-D (powers distinct) and CFI (coprime parts factor independently), a reduced atomic commutative monoid is factorial. The main algebraic result is `cor_factorial` (Corollary 8.4 in the paper).

## Logical Structure of the Proof

```
                              AXIOMS
                    ┌──────────┴──────────┐
                    │                     │
                  PP-D                   CFI
                    │                     │
                    │      ┌──────────────┼──────────────┐
                    │      │              │              │
                    │      ▼              │              ▼
                    │  Prop_CFI_implies_PPP             atoms_are_prime
                    │  (Prop 5.3)         │             (CFI => atoms prime)
                    │      │              │                   │
                    │      ▼              │                   │
                    │    PP-P             │                   │
                    │      │              │                   │
                    ├──────┤              │                   │
                    │      │              │                   │
                    ▼      ▼              ▼                   │
              Lemma_PP_Unique    prop_coprime_mult            │
              (Lemma 6.1)        (Prop 7.2)                   │
                    │            F_k multiplicative           │
                    │            on coprime inputs            │
                    ▼                                         │
              Theorem_Local_SB                                │
              (Theorem 6.2)                                   │
              F_k(p^e) = C(e+k-1,k-1)                         │
                    │                                         │
                    └─────────────┬───────────────────────────┘
                                  │
                                  ▼
                           cor_factorial
                           (Corollary 8.4)
                           M is factorial
```

## Proof Structure in the Lean Files

### cor_factorial (Corollary 8.4)
**File:** `MasterFormula_v2_aristotle.lean:656`
**Statement:** Under PP-D and CFI, M is factorial.
**Proof uses:**
- `Prop_CFI_implies_PPP` to derive PP-P from CFI
- `atoms_are_prime` to show atoms satisfy the prime property
- Proves unique factorization by showing that if two multisets of atoms have the same product, they must be equal (via valuation counts)

### atoms_are_prime
**File:** `AtomsArePrime_v2_aristotle.lean:223`
**Statement:** Under CFI, atoms are prime: if p | a*b then p | a or p | b.
**Proof uses:**
- `atoms_are_prime_coprime` for the coprime case (uses CFI bijection directly)
- `atom_dvd_multiset_prod` to handle the general case via atomic factorizations
- `atom_dvd_power_eq_of_CFI` to show atoms dividing p^k must equal p

### prop_val_additive (Proposition 8.3)
**File:** `MasterFormula_v2_aristotle.lean:604`
**Statement:** v_p(x*y) = v_p(x) + v_p(y) for all atoms p.
**Proof uses:**
- `Prop_CFI_implies_PPP` and `atoms_are_prime`
- `lemma_valuation_spec` to characterize valuations
- CFI structure to show p cannot divide both p-free parts

### prop_coprime_mult (Proposition 7.2)
**File:** `GlobalMultiplicativity.lean:195`
**Statement:** F_k(x*y) = F_k(x) * F_k(y) for coprime x, y.
**Proof uses:**
- CFI bijection directly (base case k=2)
- `count_split` and `splitFactorization` equivalence for induction
- `AreCoprime_of_dvd` to propagate coprimality to subfactors

### Theorem_Local_SB (Theorem 6.2)
**File:** `LocalCharacterization.lean:65`
**Statement:** F_k(p^e) = C(e+k-1, k-1) (stars-and-bars formula).
**Proof uses:**
- `Lemma_PP_Unique` (Lemma 6.1) to show factorizations of p^e stay in powers of p
- PP-D to count weak compositions bijectively

### Lemma_PP_Unique (Lemma 6.1)
**File:** `LocalCharacterization.lean:34`
**Statement:** If p^e = x*y, then x = p^a and y = p^(e-a) for unique a.
**Proof uses:**
- PP-P to force x, y into the submonoid generated by p
- PP-D to establish uniqueness

### Prop_CFI_implies_PPP (Proposition 5.3)
**File:** `LocalPurity.lean:612`
**Statement:** CFI implies PP-P (prime powers are factorially closed).
**Proof uses:**
- Shows that if x*y divides p^e, any atom dividing x or y must equal p
- Uses divisibility chain and atomic factorizations

### cor_squarefree (Corollary 7.3)
**File:** `MasterFormula_v2_aristotle.lean:203`
**Statement:** For squarefree m (product of distinct atoms), F_k(m) = k^(number of atoms).
**Proof uses:**
- `atoms_are_prime` for coprimality of distinct atoms
- `prop_coprime_mult` for multiplicativity
- `count_atom` showing F_k(p) = k

## File Dependency Chain

```
Basic.lean                        -- Definitions: Reduced, Atomic, CFI, PP-D, PP-P, F_k
  └─ Utilities.lean               -- Transfer lemmas, Disjoint_Support_implies_Coprime
       └─ AtomDvdPower.lean       -- atom_dvd_power_eq_of_CFI
            └─ LocalPurity.lean   -- Prop_CFI_implies_PPP (Prop 5.3)
                 └─ LocalCharacterization.lean  -- Lemma_PP_Unique (Lem 6.1), Theorem_Local_SB (Thm 6.2)
                      └─ GlobalMultiplicativity.lean  -- prop_coprime_mult (Prop 7.2)
                           └─ AtomsArePrime_v2_aristotle.lean  -- atoms_are_prime
                                └─ MasterFormula_v2_aristotle.lean  -- cor_factorial (Cor 8.4)
```

## Proven Results

| Lean Name | Paper Ref | Description |
|-----------|-----------|-------------|
| `cor_factorial` | Corollary 8.4 | PP-D + CFI implies M is factorial |
| `prop_val_additive` | Proposition 8.3 | Additivity of p-adic valuations |
| `cor_squarefree` | Corollary 7.3 | Squarefree diagnostic |
| `prop_coprime_mult` | Proposition 7.2 | Coprime multiplicativity of F_k |
| `Theorem_Local_SB` | Theorem 6.2 | Local stars-and-bars formula |
| `Lemma_PP_Unique` | Lemma 6.1 | Unique factorization in prime powers |
| `Prop_CFI_implies_PPP` | Proposition 5.3 | CFI implies PP-P |
| `atoms_are_prime` | — | Atoms are prime under CFI |

## Building

Requires Lean 4 v4.24.0 and Mathlib.

```bash
lake exe cache get   # Get Mathlib cache
lake build           # Build the project
```

## Author

Eduardo Zambrano

## License

Apache 2.0

## Acknowledgments

Some proofs were completed with assistance from [Aristotle](https://harmonic.fun/) (Harmonic's AI theorem prover).
